
    <!DOCTYPE html>
    <html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>2023å¹´ ç‰¹æ®Šç‰¹å…¸ç®¡ç†</title>
        <style>
            body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #fce4ec; color: #333; padding: 20px; }
            h1 { text-align: center; color: #c2185b; }
            .container { max-width: 1100px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
            
            /* Sticky Legend Bar */
            .legend-bar {
                position: sticky;
                top: 0;
                z-index: 2000; /* Highest priority */
                background-color: #fce4ec;
                border-bottom: 2px solid #c2185b;
                padding: 10px 5px;
                text-align: center;
                font-weight: bold;
                color: #880e4f;
                font-size: 0.85em;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 5px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }
            .legend-item { white-space: nowrap; margin: 2px 4px; }
            
            /* Remove overflow from container to let sticky headers work with body scroll */
            .container { max-width: 1100px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
            
            table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 0; }
            th, td { padding: 8px; text-align: center; border-bottom: 1px solid #eee; }
            
            /* Sticky Header (Below Legend) */
            th { 
                background-color: #f8bbd0; 
                color: #880e4f; 
                position: sticky; 
                top: 45px; /* Adjust based on typical legend height */
                z-index: 1000; 
                border-bottom: 2px solid #ad1457;
                font-size: 0.9em;
            }
            
            /* Sticky Name Column */
            th:first-child, td.name-col {
                position: sticky;
                left: 0;
                z-index: 1050; /* Above normal cells, below legend */
                border-right: 2px solid #eee;
            }
            /* Header Name Cell needs higher z-index to stay above body rows */
            th:first-child {
                z-index: 1100;
            }
            
            td.name-col { 
                text-align: left; 
                font-weight: bold; 
                min-width: 100px; 
                background-color: #fff; /* Opaque background */
            }
            
            /* User Separation */
            tr.user-start-row td {
                border-top: 3px solid #880e4f;
            }
            
            /* Checkbox Styles */
            .cb-cell { cursor: pointer; }
            input[type="checkbox"] { 
                transform: scale(1.5); 
                cursor: pointer; 
                accent-color: #e91e63;
                position: relative;
                z-index: 1;
            }
            
            /* Status */
            .status-msg { text-align: right; font-size: 0.8em; color: #888; margin-top: 5px; min-height: 1.2em; }
            
            @media (max-width: 600px) {
                body { padding: 5px; }
                .container { padding: 5px; }
                /* On mobile, let simple table scroll happen, but we want name sticky. */
                th, td { padding: 10px 2px; font-size: 0.8em; }
                input[type="checkbox"] { transform: scale(1.2); }
                
                /* Adjust top for header because legend might wrap */
                .legend-bar { position: sticky; top: 0; padding: 5px; }
                th { top: 60px; } 
                
                /* Ensure name col is visible */
                td.name-col { min-width: 80px; font-size: 0.75em; }
            }
        </style>
        <script>
            // GAS API Configuration
            const API_URL = "https://script.google.com/macros/s/AKfycbwDYIPoWIj_rPHvMeQKirmLsf8FfsvbP9WPi5Zq8Yk02ll-uTH40F19SV2sPUr1IZLy/exec"; 

            document.addEventListener('DOMContentLoaded', () => {
                // Load saved data
                if(API_URL && API_URL.startsWith("http")) {
                    fetch(API_URL)
                        .then(r => r.json())
                        .then(allData => {
                            console.log("Loaded data:", allData);
                            // Apply to checkboxes
                            // data format expected: { "UserName": { "EventKey_Num": true, ... } }
                            for (const [user, checks] of Object.entries(allData)) {
                                if (!checks) continue;
                                for (const [key, isChecked] of Object.entries(checks)) {
                                    if(isChecked) {
                                        const lastUnder = key.lastIndexOf('_');
                                        if(lastUnder > 0) {
                                            const eKey = key.substring(0, lastUnder);
                                            const num = key.substring(lastUnder + 1);
                                            
                                            // Escape selectors for JS template literal inside Python f-string

                                            const cb = document.querySelector(`input[data-user="${user}"][data-event="${eKey}"][data-num="${num}"]`);
                                            if(cb) cb.checked = true;
                                        }
                                    }
                                }
                            }
                        })
                        .catch(e => console.error("Load Error:", e));
                }

                // Change Handler
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.addEventListener('change', (e) => {
                        const user = e.target.dataset.user;
                        const eventKey = e.target.dataset.event;
                        const num = e.target.dataset.num;
                        const isChecked = e.target.checked;
                        
                        // Limit Check: Max 2 per event/user
                        if (isChecked) {
                            const groupSelector = `input[data-user="${user}"][data-event="${eventKey}"]:checked`;
                            const checkedCount = document.querySelectorAll(groupSelector).length;
                            
                            if (checkedCount > 2) {
                                e.target.checked = false; // Revert
                                alert("ç‰¹å…¸ã¯1ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ã¤ã2ã¤ã¾ã§ã§ã™ã€‚");
                                return; // Stop saving
                            }
                        }
                        
                        saveData(user, num, isChecked, eventKey);
                    });
                });
            });

            let saveQueue = [];
            let isSaving = false;

            function saveData(user, num, isChecked, eventKey) {
                if(!API_URL || !API_URL.startsWith("http")) return;
                
                const updateKey = `${eventKey}_${num}`;
                const payload = {
                    user: user,
                    update: { [updateKey]: isChecked }
                };
                
                // Add to queue
                saveQueue.push(payload);
                processQueue();
            }
            
            function processQueue() {
                if (isSaving || saveQueue.length === 0) return;
                
                isSaving = true;
                const statusEl = document.getElementById('status');
                statusEl.innerText = `Saving... (Queue: ${saveQueue.length})`;
                
                const payload = saveQueue.shift(); // Get next item
                
                fetch(API_URL, {
                    method: "POST",
                    body: JSON.stringify(payload)
                })
                .then(r => {
                    // Success
                    if (saveQueue.length === 0) {
                        statusEl.innerText = "Saved";
                        setTimeout(() => statusEl.innerText = "", 2000);
                    } else {
                         // Continue processing immediately
                         // statusEl text will update on next loop
                    }
                })
                .catch(e => {
                    console.error(e);
                    statusEl.innerText = "Error! Retrying...";
                    // Optional: Put it back in queue? Or just log error.
                    // For now, let's just log and move on to prevent blocking.
                })
                .finally(() => {
                    isSaving = false;
                    if (saveQueue.length > 0) {
                        processQueue();
                    }
                });
            }
        </script>
    </head>
    <body>
        <div class="container">
            <h1>ğŸ‘‘ 2023å¹´ ç‰¹æ®Šç‰¹å…¸ç®¡ç†</h1>
            <div id="status" class="status-msg"></div>
            <!-- Sticky Legend Bar -->
            <div class="legend-bar">
                <span class="legend-item">â‘ ğŸ©æ‰‹ä½œã‚Š</span>
                <span class="legend-item">â‘¡ğŸ™ï¸ãƒœã‚¤ã‚¹</span>
                <span class="legend-item">â‘¢ğŸ“·å†™çœŸ</span>
                <span class="legend-item">â‘£ğŸ¨ã‚¤ãƒ©ã‚¹ãƒˆ</span>
                <span class="legend-item">â‘¤ğŸ‘•ã‚¢ãƒã‚¿ãƒ¼</span>
                <span class="legend-item">â‘¥ğŸ«æŠ½é¸åˆ¸</span>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Event</th>
                        <th><div style="font-size:1.5em;">ğŸ©</div>1</th>
                        <th><div style="font-size:1.5em;">ğŸ™ï¸</div>2</th>
                        <th><div style="font-size:1.5em;">ğŸ“·</div>3</th>
                        <th><div style="font-size:1.5em;">ğŸ¨</div>4</th>
                        <th><div style="font-size:1.5em;">ğŸ‘•</div>5</th>
                        <th><div style="font-size:1.5em;">ğŸ«</div>6</th>
                    </tr>
                </thead>
                <tbody>
    
                <tr class="user-start-row">
                    <td class="name-col" rowspan="1">ğŸ’ã‚µãƒ«ã‚¯ã‚µğŸ’ğ“¡ğ“®ğ“·ã¨ãƒãƒğŸ—ï¸ãƒ¦ãƒ12æ—¥ã‹ã‚‰ã‚¬ãƒ<br><span style="font-size:0.8em; color:#888;">(ğŸ‘‘1)</span></td>
                    <td style="text-align:left; font-size:0.9em;">ã€æœ¬é¸ï¼šFinal Stageã€‘ã€TOKYO KIMONO AWARD 2024ã€</td>
                    
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ğŸ’ã‚µãƒ«ã‚¯ã‚µğŸ’ğ“¡ğ“®ğ“·ã¨ãƒãƒğŸ—ï¸ãƒ¦ãƒ12æ—¥ã‹ã‚‰ã‚¬ãƒ" data-event="tokyo_kimono2024_final" data-num="1">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ğŸ’ã‚µãƒ«ã‚¯ã‚µğŸ’ğ“¡ğ“®ğ“·ã¨ãƒãƒğŸ—ï¸ãƒ¦ãƒ12æ—¥ã‹ã‚‰ã‚¬ãƒ" data-event="tokyo_kimono2024_final" data-num="2">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ğŸ’ã‚µãƒ«ã‚¯ã‚µğŸ’ğ“¡ğ“®ğ“·ã¨ãƒãƒğŸ—ï¸ãƒ¦ãƒ12æ—¥ã‹ã‚‰ã‚¬ãƒ" data-event="tokyo_kimono2024_final" data-num="3">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ğŸ’ã‚µãƒ«ã‚¯ã‚µğŸ’ğ“¡ğ“®ğ“·ã¨ãƒãƒğŸ—ï¸ãƒ¦ãƒ12æ—¥ã‹ã‚‰ã‚¬ãƒ" data-event="tokyo_kimono2024_final" data-num="4">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ğŸ’ã‚µãƒ«ã‚¯ã‚µğŸ’ğ“¡ğ“®ğ“·ã¨ãƒãƒğŸ—ï¸ãƒ¦ãƒ12æ—¥ã‹ã‚‰ã‚¬ãƒ" data-event="tokyo_kimono2024_final" data-num="5">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ğŸ’ã‚µãƒ«ã‚¯ã‚µğŸ’ğ“¡ğ“®ğ“·ã¨ãƒãƒğŸ—ï¸ãƒ¦ãƒ12æ—¥ã‹ã‚‰ã‚¬ãƒ" data-event="tokyo_kimono2024_final" data-num="6">
                    </td>
                
                </tr>
            
                <tr class="user-start-row">
                    <td class="name-col" rowspan="1">å‰£(ã¤ã‚‹ãï¼‰â™¡ã„ã¨æ„›ã—â™¡å„ªèŠ­ãã‚“ã‚¬ãƒä¸­ğŸ—ï¸ğŸ¦Œâ™¨ï¸ãŠ¸<br><span style="font-size:0.8em; color:#888;">(ğŸ‘‘1)</span></td>
                    <td style="text-align:left; font-size:0.9em;">ã€æœ¬é¸ï¼šFinal Stageã€‘ã€TOKYO KIMONO AWARD 2024ã€</td>
                    
                    <td class="cb-cell">
                        <input type="checkbox" data-user="å‰£(ã¤ã‚‹ãï¼‰â™¡ã„ã¨æ„›ã—â™¡å„ªèŠ­ãã‚“ã‚¬ãƒä¸­ğŸ—ï¸ğŸ¦Œâ™¨ï¸ãŠ¸" data-event="tokyo_kimono2024_final" data-num="1">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="å‰£(ã¤ã‚‹ãï¼‰â™¡ã„ã¨æ„›ã—â™¡å„ªèŠ­ãã‚“ã‚¬ãƒä¸­ğŸ—ï¸ğŸ¦Œâ™¨ï¸ãŠ¸" data-event="tokyo_kimono2024_final" data-num="2">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="å‰£(ã¤ã‚‹ãï¼‰â™¡ã„ã¨æ„›ã—â™¡å„ªèŠ­ãã‚“ã‚¬ãƒä¸­ğŸ—ï¸ğŸ¦Œâ™¨ï¸ãŠ¸" data-event="tokyo_kimono2024_final" data-num="3">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="å‰£(ã¤ã‚‹ãï¼‰â™¡ã„ã¨æ„›ã—â™¡å„ªèŠ­ãã‚“ã‚¬ãƒä¸­ğŸ—ï¸ğŸ¦Œâ™¨ï¸ãŠ¸" data-event="tokyo_kimono2024_final" data-num="4">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="å‰£(ã¤ã‚‹ãï¼‰â™¡ã„ã¨æ„›ã—â™¡å„ªèŠ­ãã‚“ã‚¬ãƒä¸­ğŸ—ï¸ğŸ¦Œâ™¨ï¸ãŠ¸" data-event="tokyo_kimono2024_final" data-num="5">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="å‰£(ã¤ã‚‹ãï¼‰â™¡ã„ã¨æ„›ã—â™¡å„ªèŠ­ãã‚“ã‚¬ãƒä¸­ğŸ—ï¸ğŸ¦Œâ™¨ï¸ãŠ¸" data-event="tokyo_kimono2024_final" data-num="6">
                    </td>
                
                </tr>
            
                <tr class="user-start-row">
                    <td class="name-col" rowspan="1">ãƒãƒ ãƒãƒ  â…YUHAğŸ—(12æ—¥~ã‚¬ãƒã‚¤ãƒ™ğŸ”¥)<br><span style="font-size:0.8em; color:#888;">(ğŸ‘‘1)</span></td>
                    <td style="text-align:left; font-size:0.9em;">ã€æœ¬é¸ï¼šFinal Stageã€‘ã€TOKYO KIMONO AWARD 2024ã€</td>
                    
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ãƒãƒ ãƒãƒ  â…YUHAğŸ—(12æ—¥~ã‚¬ãƒã‚¤ãƒ™ğŸ”¥)" data-event="tokyo_kimono2024_final" data-num="1">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ãƒãƒ ãƒãƒ  â…YUHAğŸ—(12æ—¥~ã‚¬ãƒã‚¤ãƒ™ğŸ”¥)" data-event="tokyo_kimono2024_final" data-num="2">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ãƒãƒ ãƒãƒ  â…YUHAğŸ—(12æ—¥~ã‚¬ãƒã‚¤ãƒ™ğŸ”¥)" data-event="tokyo_kimono2024_final" data-num="3">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ãƒãƒ ãƒãƒ  â…YUHAğŸ—(12æ—¥~ã‚¬ãƒã‚¤ãƒ™ğŸ”¥)" data-event="tokyo_kimono2024_final" data-num="4">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ãƒãƒ ãƒãƒ  â…YUHAğŸ—(12æ—¥~ã‚¬ãƒã‚¤ãƒ™ğŸ”¥)" data-event="tokyo_kimono2024_final" data-num="5">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ãƒãƒ ãƒãƒ  â…YUHAğŸ—(12æ—¥~ã‚¬ãƒã‚¤ãƒ™ğŸ”¥)" data-event="tokyo_kimono2024_final" data-num="6">
                    </td>
                
                </tr>
            
                <tr class="user-start-row">
                    <td class="name-col" rowspan="1">â„ã„ãªã£ã¡ãã‚“ğŸ—â„â€ª <br><span style="font-size:0.8em; color:#888;">(ğŸ‘‘1)</span></td>
                    <td style="text-align:left; font-size:0.9em;">ã€æœ¬é¸ï¼šFinal Stageã€‘ã€TOKYO KIMONO AWARD 2024ã€</td>
                    
                    <td class="cb-cell">
                        <input type="checkbox" data-user="â„ã„ãªã£ã¡ãã‚“ğŸ—â„â€ª " data-event="tokyo_kimono2024_final" data-num="1">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="â„ã„ãªã£ã¡ãã‚“ğŸ—â„â€ª " data-event="tokyo_kimono2024_final" data-num="2">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="â„ã„ãªã£ã¡ãã‚“ğŸ—â„â€ª " data-event="tokyo_kimono2024_final" data-num="3">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="â„ã„ãªã£ã¡ãã‚“ğŸ—â„â€ª " data-event="tokyo_kimono2024_final" data-num="4">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="â„ã„ãªã£ã¡ãã‚“ğŸ—â„â€ª " data-event="tokyo_kimono2024_final" data-num="5">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="â„ã„ãªã£ã¡ãã‚“ğŸ—â„â€ª " data-event="tokyo_kimono2024_final" data-num="6">
                    </td>
                
                </tr>
            
                <tr class="user-start-row">
                    <td class="name-col" rowspan="1">*Â¨*<br><span style="font-size:0.8em; color:#888;">(ğŸ‘‘1)</span></td>
                    <td style="text-align:left; font-size:0.9em;">ã€æœ¬é¸ï¼šFinal Stageã€‘ã€TOKYO KIMONO AWARD 2024ã€</td>
                    
                    <td class="cb-cell">
                        <input type="checkbox" data-user="*Â¨*" data-event="tokyo_kimono2024_final" data-num="1">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="*Â¨*" data-event="tokyo_kimono2024_final" data-num="2">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="*Â¨*" data-event="tokyo_kimono2024_final" data-num="3">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="*Â¨*" data-event="tokyo_kimono2024_final" data-num="4">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="*Â¨*" data-event="tokyo_kimono2024_final" data-num="5">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="*Â¨*" data-event="tokyo_kimono2024_final" data-num="6">
                    </td>
                
                </tr>
            
                <tr class="user-start-row">
                    <td class="name-col" rowspan="1">ï¾ï¾™ï½¸ ğŸ¼   ğŸŒ»   YUHAğŸ—ã‚¬ãƒã‚¤ãƒ™ä¸­ã§ã™<br><span style="font-size:0.8em; color:#888;">(ğŸ‘‘1)</span></td>
                    <td style="text-align:left; font-size:0.9em;">ã€æœ¬é¸ï¼šFinal Stageã€‘ã€TOKYO KIMONO AWARD 2024ã€</td>
                    
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ï¾ï¾™ï½¸ ğŸ¼   ğŸŒ»   YUHAğŸ—ã‚¬ãƒã‚¤ãƒ™ä¸­ã§ã™" data-event="tokyo_kimono2024_final" data-num="1">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ï¾ï¾™ï½¸ ğŸ¼   ğŸŒ»   YUHAğŸ—ã‚¬ãƒã‚¤ãƒ™ä¸­ã§ã™" data-event="tokyo_kimono2024_final" data-num="2">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ï¾ï¾™ï½¸ ğŸ¼   ğŸŒ»   YUHAğŸ—ã‚¬ãƒã‚¤ãƒ™ä¸­ã§ã™" data-event="tokyo_kimono2024_final" data-num="3">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ï¾ï¾™ï½¸ ğŸ¼   ğŸŒ»   YUHAğŸ—ã‚¬ãƒã‚¤ãƒ™ä¸­ã§ã™" data-event="tokyo_kimono2024_final" data-num="4">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ï¾ï¾™ï½¸ ğŸ¼   ğŸŒ»   YUHAğŸ—ã‚¬ãƒã‚¤ãƒ™ä¸­ã§ã™" data-event="tokyo_kimono2024_final" data-num="5">
                    </td>
                
                    <td class="cb-cell">
                        <input type="checkbox" data-user="ï¾ï¾™ï½¸ ğŸ¼   ğŸŒ»   YUHAğŸ—ã‚¬ãƒã‚¤ãƒ™ä¸­ã§ã™" data-event="tokyo_kimono2024_final" data-num="6">
                    </td>
                
                </tr>
            
                </tbody>
            </table>
        </div>
    </body>
    </html>
    