<script>
  async function loadCSV() {
    try {
      // キャッシュ回避
      const response = await fetch("https://hirottarow.github.io/projectname/filtered_ranking.csv?cachebust=" + Date.now());
      const text = await response.text();

      const lines = text.trim().split("\n");
      // ヘッダーを除く
      const rows = lines.slice(1).filter(line => line.trim() !== "");

      let html = "";

      if (rows.length === 0) {
        // データなしの場合
        html = "<div style='padding:10px; color:#fff; font-weight:bold;'>直近の訪問回数キリ番者はなし</div>";
      } else {
        // データありの場合はタイトル + テーブル表示
        html += "<div style='padding:4px; color:#fff; font-weight:bold; text-align:left;'>キリ番者</div>";
        html += "<table style='width:100%; border-collapse: collapse; font-size:14px;'>";
        html += "<tr><th style='text-align:left; padding:4px;'>Rank</th><th style='text-align:left; padding:4px;'>Name</th><th style='text-align:right; padding:4px;'>Visit</th></tr>";

        rows.forEach(row => {
          const [rank, name, visit] = row.split(",");
          html += `<tr>
                     <td style='padding:4px;'>${rank}</td>
                     <td style='padding:4px;'>${name}</td>
                     <td style='padding:4px; text-align:right;'>${visit}</td>
                   </tr>`;
        });

        html += "</table>";
      }

      document.getElementById("csv-display").innerHTML = html;
    } catch (e) {
      document.getElementById("csv-display").textContent = "⚠️ CSVを読み込めませんでした";
    }
  }

  loadCSV();
</script>
